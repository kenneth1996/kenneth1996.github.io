<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">

    

    

    <title>分布式文件系统-Ceph | SRE</title>
    <meta name="author" content="John Doe">
    <meta name="version" content="1.0.0">
    <meta name="keywords" content="">
    <meta name="description" content="一、 Ceph简介1、Ceph是什么Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性，最早起源于Sage就读博士期间的工作（最早的成果于2004年发表），并随后贡献给开源社区。在经过了数年的发展之后，目前已得到众多云计算厂商的支持并被广泛应用。RedHat及OpenStack都可与Ceph整合以支持虚拟机镜像的后端存储。Ceph是一个可靠地、自动重均衡、自动恢复的分布式存储系统，根据场景划分可以将Ceph分为三大块，分别是对象存储、块设备存储和文件系统服务。...">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="SRE" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <main class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">SRE</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/categories/front-end">
                <span class="nav-text">Linux</span>
            </a>
        
            <a class="nav-item" href="/categories/back-end">
                <span class="nav-text">Python</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://kenneth96.coding.me"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#一、-Ceph简介"><span class="toc-number">1.</span> <span class="toc-text">一、 Ceph简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1、Ceph是什么"><span class="toc-number">1.1.</span> <span class="toc-text">1、Ceph是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2、体系架构"><span class="toc-number">1.2.</span> <span class="toc-text">2、体系架构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3、Ceph特点"><span class="toc-number">1.3.</span> <span class="toc-text">3、Ceph特点</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#①-高性能"><span class="toc-number">1.3.1.</span> <span class="toc-text">① 高性能</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#②-高可用性"><span class="toc-number">1.3.2.</span> <span class="toc-text">② 高可用性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#③-高可扩展性"><span class="toc-number">1.3.3.</span> <span class="toc-text">③ 高可扩展性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#④-特性丰富"><span class="toc-number">1.3.4.</span> <span class="toc-text">④ 特性丰富</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二、安装部署"><span class="toc-number">2.</span> <span class="toc-text">二、安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1、基础环境"><span class="toc-number">2.1.</span> <span class="toc-text">1、基础环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2、镜像准备"><span class="toc-number">2.2.</span> <span class="toc-text">2、镜像准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3、添加Ceph-Helm到本地repo"><span class="toc-number">2.3.</span> <span class="toc-text">3、添加Ceph-Helm到本地repo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4、配置Ceph集群"><span class="toc-number">2.4.</span> <span class="toc-text">4、配置Ceph集群</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5、创建namespace"><span class="toc-number">2.5.</span> <span class="toc-text">5、创建namespace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6、配置RBAC权限"><span class="toc-number">2.6.</span> <span class="toc-text">6、配置RBAC权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7、给Kubelet节点打标签"><span class="toc-number">2.7.</span> <span class="toc-text">7、给Kubelet节点打标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8、准备镜像"><span class="toc-number">2.8.</span> <span class="toc-text">8、准备镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9、Ceph部署"><span class="toc-number">2.9.</span> <span class="toc-text">9、Ceph部署</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三、实际应用"><span class="toc-number">3.</span> <span class="toc-text">三、实际应用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1、创建一个使用此pvc的pod"><span class="toc-number">3.1.</span> <span class="toc-text">1、创建一个使用此pvc的pod</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2、检查pod"><span class="toc-number">3.2.</span> <span class="toc-text">2、检查pod</span></a></li></ol></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope="" itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            分布式文件系统-Ceph
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://kenneth96.coding.me/2019/05/24/分布式文件系统-Ceph/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2019-05-24T08:43:41.000Z" itemprop="datePublished">2019-05-24</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/Ceph/">Ceph</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <h4 id="一、-Ceph简介"><a href="#一、-Ceph简介" class="headerlink" title="一、 Ceph简介"></a>一、 Ceph简介</h4><p><img src="https://k-linux.oss-cn-beijing.aliyuncs.com/images/ceph1.png" alt=""></p>
<h5 id="1、Ceph是什么"><a href="#1、Ceph是什么" class="headerlink" title="1、Ceph是什么"></a>1、Ceph是什么</h5><p>Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性，最早起源于Sage就读博士期间的工作（最早的成果于2004年发表），并随后贡献给开源社区。在经过了数年的发展之后，目前已得到众多云计算厂商的支持并被广泛应用。RedHat及OpenStack都可与Ceph整合以支持虚拟机镜像的后端存储。<br><a id="more"></a><br>Ceph是一个可靠地、自动重均衡、自动恢复的分布式存储系统，根据场景划分可以将Ceph分为三大块，分别是对象存储、块设备存储和文件系统服务。在虚拟化领域里，比较常用到的是Ceph的块设备存储，比如在OpenStack项目里，Ceph的块设备存储可以对接OpenStack的cinder后端存储、Glance的镜像存储和虚拟机的数据存储，比较直观的是Ceph集群可以提供一个raw格式的块存储来作为虚拟机实例的硬盘。</p>
<p>Ceph相比其它存储的优势点在于它不单单是存储，同时还充分利用了存储节点上的计算能力，在存储每一个数据时，都会通过计算得出该数据存储的位置，尽量将数据分布均衡，同时由于Ceph的良好设计，采用了CRUSH算法、HASH环等方法，使得它不存在传统的单点故障的问题，且随着规模的扩大性能并不会受到影响。</p>
<h5 id="2、体系架构"><a href="#2、体系架构" class="headerlink" title="2、体系架构"></a>2、体系架构</h5><p>Ceph 独一无二地用统一的系统提供了<strong>对象、块、和文件存储</strong>功能，它可靠性高、管理简便、并且是自由软件。 Ceph 的强大足以改变贵公司的 IT 基础架构、和管理海量数据的能力。Ceph 可提供极大的伸缩性——供成千用户访问 PB 乃至 EB 级的数据。Ceph 节点以普通硬件和智能守护进程作为支撑点，Ceph 存储集群组织起了大量节点，它们之间靠相互通讯来复制数据、并动态地重分布数据。</p>
<p> <img src="http://docs.ceph.org.cn/_images/stack.png" alt=""></p>
<ul>
<li><strong>Ceph OSDs</strong>: Ceph OSD 守护进程（ Ceph OSD ）的功能是存储数据，处理数据的复制、恢复、回填、再均衡，并通过检查其他OSD 守护进程的心跳来向 Ceph Monitors 提供一些监控信息。当 Ceph 存储集群设定为有2个副本时，至少需要2个 OSD 守护进程，集群才能达到 <code>active+clean</code> 状态（ Ceph 默认有3个副本，但你可以调整副本数）。</li>
<li><strong>Monitors</strong>: Ceph Monitor维护着展示集群状态的各种图表，包括监视器图、 OSD 图、归置组（ PG ）图、和 CRUSH 图。 Ceph 保存着发生在Monitors 、 OSD 和 PG上的每一次状态变更的历史信息（称为 epoch ）。</li>
<li><strong>MDSs</strong>: Ceph 元数据服务器（ MDS ）为 Ceph 文件系统存储元数据（也就是说，Ceph 块设备和 Ceph 对象存储不使用MDS ）。元数据服务器使得 POSIX 文件系统的用户们，可以在不对 Ceph 存储集群造成负担的前提下，执行诸如 <code>ls</code>、<code>find</code> 等基本命令。</li>
</ul>
<p>Ceph 把客户端数据保存为存储池内的对象。通过使用 CRUSH 算法， Ceph 可以计算出哪个归置组（PG）应该持有指定的对象(Object)，然后进一步计算出哪个 OSD 守护进程持有该归置组。 CRUSH 算法使得 Ceph 存储集群能够动态地伸缩、再均衡和修复。 </p>
<h5 id="3、Ceph特点"><a href="#3、Ceph特点" class="headerlink" title="3、Ceph特点"></a>3、Ceph特点</h5><h6 id="①-高性能"><a href="#①-高性能" class="headerlink" title="① 高性能"></a>① 高性能</h6><ul>
<li>a. 摒弃了传统的集中式存储元数据寻址的方案，采用CRUSH算法，数据分布均衡，并行度高。</li>
<li>b.考虑了容灾域的隔离，能够实现各类负载的副本放置规则，例如跨机房、机架感知等。</li>
<li>c. 能够支持上千个存储节点的规模，支持TB到PB级的数据。</li>
</ul>
<h6 id="②-高可用性"><a href="#②-高可用性" class="headerlink" title="② 高可用性"></a>② 高可用性</h6><ul>
<li>a. 副本数可以灵活控制。</li>
<li>b. 支持故障域分隔，数据强一致性。</li>
<li>c. 多种故障场景自动进行修复自愈。</li>
<li>d. 没有单点故障，自动管理。</li>
</ul>
<h6 id="③-高可扩展性"><a href="#③-高可扩展性" class="headerlink" title="③ 高可扩展性"></a>③ 高可扩展性</h6><ul>
<li>a. 去中心化。</li>
<li>b. 扩展灵活。</li>
<li>c. 随着节点增加而线性增长。</li>
</ul>
<h6 id="④-特性丰富"><a href="#④-特性丰富" class="headerlink" title="④ 特性丰富"></a>④ 特性丰富</h6><ul>
<li>a. 支持三种存储接口：块存储、文件存储、对象存储。</li>
<li>b. 支持自定义接口，支持多种语言驱动。</li>
</ul>
<h4 id="二、安装部署"><a href="#二、安装部署" class="headerlink" title="二、安装部署"></a>二、安装部署</h4><h5 id="1、基础环境"><a href="#1、基础环境" class="headerlink" title="1、基础环境"></a>1、基础环境</h5><p>本地环境：</p>
<table>
<thead>
<tr>
<th style="text-align:center">k8s-master</th>
<th style="text-align:center">192.168.74.128</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">node1</td>
<td style="text-align:center">192.168.74.129</td>
</tr>
<tr>
<td style="text-align:center">node2</td>
<td style="text-align:center">192.168.74.130</td>
</tr>
<tr>
<td style="text-align:center">node3</td>
<td style="text-align:center">192.168.74.131</td>
</tr>
</tbody>
</table>
<p>软件环境：</p>
<table>
<thead>
<tr>
<th style="text-align:center">操作系统</th>
<th style="text-align:center">CentOS Linux release 7.6.1810</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Kubernetes</td>
<td style="text-align:center">1.14.0</td>
</tr>
<tr>
<td style="text-align:center">Helm</td>
<td style="text-align:center">2.13.1</td>
</tr>
</tbody>
</table>
<h5 id="2、镜像准备"><a href="#2、镜像准备" class="headerlink" title="2、镜像准备"></a>2、镜像准备</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.io/ceph/daemon:tag-build-master-luminous-ubuntu-<span class="number">16.04</span></span><br><span class="line">docker pull docker.io/kolla/ubuntu-source-kubernetes-entrypoint:<span class="number">4.0</span>.<span class="number">0</span></span><br><span class="line">docker pull docker.io/port/ceph-config-helper:v1.<span class="number">7.5</span></span><br><span class="line">docker pull quay.io/external_storage/rbd-provisioner:v0.<span class="number">1.1</span></span><br><span class="line">docker pull docker.io/alpine:latest</span><br></pre></td></tr></table></figure>
<h5 id="3、添加Ceph-Helm到本地repo"><a href="#3、添加Ceph-Helm到本地repo" class="headerlink" title="3、添加Ceph-Helm到本地repo"></a>3、添加Ceph-Helm到本地repo</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-m ~]<span class="comment"># git clone https://github.com/ceph/ceph-helm</span></span><br><span class="line">[root@k8s-m ~]<span class="comment"># cd ceph-helm/ceph</span></span><br><span class="line">[root@k8s-m ~]<span class="comment"># make</span></span><br></pre></td></tr></table></figure>
<h5 id="4、配置Ceph集群"><a href="#4、配置Ceph集群" class="headerlink" title="4、配置Ceph集群"></a>4、配置Ceph集群</h5><p>创建一个包含Ceph配置的<code>ceph-overrides.yaml</code>文件。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">network:</span><br><span class="line">  public:  <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span>    <span class="comment"># 主机机器的ip  不是k8s集群的ip范围</span></span><br><span class="line">  cluster:  <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span>     <span class="comment"># 必须与public相同</span></span><br><span class="line"></span><br><span class="line">osd_devices:</span><br><span class="line">  - name: dev-sdd</span><br><span class="line">    device: /dev/vdb     <span class="comment"># 使用前或者重新安装前都要mkfs.ext4   /dev/vdb格式化，会自动分为两个分区</span></span><br><span class="line">    zap: <span class="string">"1"</span></span><br><span class="line">  - name: dev-sde</span><br><span class="line">    device: /dev/sde</span><br><span class="line">    zap: <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line">storageclass:</span><br><span class="line">  name: ceph-rbd</span><br><span class="line">  pool: rbd</span><br><span class="line">  user_id: admin        <span class="comment"># 如果不用这个名称要自己创建秘钥</span></span><br></pre></td></tr></table></figure>
<p>注意 如果未设置日志（journal）设备，它将与device设备同位置。另ceph-helm/ceph/ceph/values.yaml文件包含所有可配置的选项。 </p>
<h5 id="5、创建namespace"><a href="#5、创建namespace" class="headerlink" title="5、创建namespace"></a>5、创建namespace</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-m ~]<span class="comment"># kubectl create namespace ceph</span></span><br><span class="line">namespace/ceph created</span><br></pre></td></tr></table></figure>
<h5 id="6、配置RBAC权限"><a href="#6、配置RBAC权限" class="headerlink" title="6、配置RBAC权限"></a>6、配置RBAC权限</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-m ~]<span class="comment"># kubectl create -f ~/ceph-helm/ceph/rbac.yaml</span></span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ceph-all created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/ceph-sc created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/kube-system-cm created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/role-ceph created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/role-kube-system created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/role-ceph-in-ceph created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/role-ceph-sc created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/role-ceph-sc-ns-ceph created</span><br></pre></td></tr></table></figure>
<h5 id="7、给Kubelet节点打标签"><a href="#7、给Kubelet节点打标签" class="headerlink" title="7、给Kubelet节点打标签"></a>7、给Kubelet节点打标签</h5><p>需要设置以下标签才能部署Ceph集群：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">eph-mon=enabled</span><br><span class="line">ceph-mgr=enabled</span><br><span class="line">ceph-osd=enabled</span><br><span class="line">ceph-rgw=enabled </span><br><span class="line">ceph-mds=enabled </span><br><span class="line">ceph-osd-device-&lt;name&gt;=enabled</span><br></pre></td></tr></table></figure>
<p>ceph-osd-device-标签是基于我们的ceph-overrides.yaml中定义的osd_devices名称值创建的。从我们下面的例子中，我们将得到以下两个标签：ceph-osd-device-dev-sdb和ceph-osd-device-dev-sdc。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl label node node-<span class="number">1</span> ceph-mon=enabled</span><br><span class="line">kubectl label node node-<span class="number">2</span> ceph-mon=enabled</span><br><span class="line">kubectl label node node-<span class="number">3</span> ceph-mon=enabled</span><br><span class="line"></span><br><span class="line">kubectl label node node-<span class="number">1</span> ceph-mgr=enabled</span><br><span class="line"></span><br><span class="line">kubectl label node node-<span class="number">1</span>  ceph-osd-device-dev-vdb=enabled ceph-osd=enabled</span><br><span class="line">kubectl label node node-<span class="number">2</span>  ceph-osd-device-dev-vdb=enabled ceph-osd=enabled</span><br><span class="line">kubectl label node node-<span class="number">3</span>  ceph-osd-device-dev-vdb=enabled ceph-osd=enabled</span><br></pre></td></tr></table></figure>
<h5 id="8、准备镜像"><a href="#8、准备镜像" class="headerlink" title="8、准备镜像"></a>8、准备镜像</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.io/ceph/daemon:tag-build-master-luminous-ubuntu-16.04</span><br><span class="line">docker pull docker.io/kolla/ubuntu-source-kubernetes-entrypoint:4.0.0</span><br><span class="line">docker pull docker.io/port/ceph-config-helper:v1.7.5</span><br><span class="line">docker pull quay.io/external_storage/rbd-provisioner:v0.1.1</span><br><span class="line">docker pull docker.io/alpine:latest</span><br></pre></td></tr></table></figure>
<h5 id="9、Ceph部署"><a href="#9、Ceph部署" class="headerlink" title="9、Ceph部署"></a>9、Ceph部署</h5><p>运行helm install命令来部署local仓库的Ceph： </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-m ~]<span class="comment">#  helm install --name=ceph local/ceph --namespace=ceph -f ~/ceph-overrides.yaml</span></span><br><span class="line">NAME:   ceph</span><br><span class="line">LAST DEPLOYED: Fri Apr <span class="number">26</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">01</span> <span class="number">2019</span></span><br><span class="line">NAMESPACE: ceph</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/ConfigMap</span><br><span class="line">NAME              <span class="keyword">DATA</span>  AGE</span><br><span class="line">ceph-bin          <span class="number">26</span>    <span class="number">1</span>s</span><br><span class="line">ceph-bin-clients  <span class="number">2</span>     <span class="number">1</span>s</span><br><span class="line">ceph-etc          <span class="number">1</span>     <span class="number">1</span>s</span><br><span class="line">ceph-templates    <span class="number">5</span>     <span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Job</span><br><span class="line">NAME                                 COMPLETIONS  DURATION  AGE</span><br><span class="line">ceph-mds-keyring-generator           <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">0</span>s</span><br><span class="line">ceph-mgr-keyring-generator           <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">0</span>s</span><br><span class="line">ceph-mon-keyring-generator           <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">1</span>s</span><br><span class="line">ceph-namespace-client-key-generator  <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">0</span>s</span><br><span class="line">ceph-osd-keyring-generator           <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">1</span>s</span><br><span class="line">ceph-rgw-keyring-generator           <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">1</span>s</span><br><span class="line">ceph-storage-keys-generator          <span class="number">0</span>/<span class="number">1</span>          <span class="number">0</span>s        <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                                       READY  STATUS             RESTARTS  AGE</span><br><span class="line">ceph-mds-<span class="number">75</span>dc968dc7-qlwn5                  <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-mds-keyring-generator-gvkhv           <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line">ceph-mgr-<span class="number">75</span>f4c4dc76-<span class="number">2</span>khrn                  <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-mgr-keyring-generator-ctrpp           <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line">ceph-mon-check-<span class="number">85</span>d59b5fd4-cdhrr            <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-mon-keyring-generator-j4tkh           <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-namespace-client-key-generator-<span class="number">2</span>qg7p  <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line">ceph-osd-keyring-generator-<span class="number">24</span>gtx           <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line">ceph-rbd-provisioner-d59d65f74-<span class="number">4</span>fmvw       <span class="number">0</span>/<span class="number">1</span>    ContainerCreating  <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-rbd-provisioner-d59d65f74-kqm4p       <span class="number">0</span>/<span class="number">1</span>    ContainerCreating  <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-rgw-<span class="number">7598</span>c7788-kw6b5                   <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line">ceph-rgw-keyring-generator-t5pbz           <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">1</span>s</span><br><span class="line">ceph-storage-keys-generator-thdpc          <span class="number">0</span>/<span class="number">1</span>    Pending            <span class="number">0</span>         <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                    TYPE    <span class="keyword">DATA</span>  AGE</span><br><span class="line">ceph-keystone-user-rgw  Opaque  <span class="number">7</span>     <span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME      TYPE       CLUSTER-IP    EXTERNAL-IP  PORT(S)   AGE</span><br><span class="line">ceph-mon  ClusterIP  None          &lt;none&gt;       <span class="number">6789</span>/TCP  <span class="number">1</span>s</span><br><span class="line">ceph-rgw  ClusterIP  <span class="number">10.98</span>.<span class="number">76.159</span>  &lt;none&gt;       <span class="number">8088</span>/TCP  <span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1/StorageClass</span><br><span class="line">NAME      PROVISIONER   AGE</span><br><span class="line">ceph-rbd  ceph.com/rbd  <span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/DaemonSet</span><br><span class="line">NAME              DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE  NODE SELECTOR                                     AGE</span><br><span class="line">ceph-mon          <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>      <span class="number">0</span>           <span class="number">0</span>          ceph-mon=enabled                                  <span class="number">1</span>s</span><br><span class="line">ceph-osd-dev-sdd  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>      <span class="number">0</span>           <span class="number">0</span>          ceph-osd-device-dev-sdd=enabled,ceph-osd=enabled  <span class="number">1</span>s</span><br><span class="line">ceph-osd-dev-sde  <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>      <span class="number">0</span>           <span class="number">0</span>          ceph-osd-device-dev-sde=enabled,ceph-osd=enabled  <span class="number">1</span>s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/Deployment</span><br><span class="line">NAME                  READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">ceph-mds              <span class="number">0</span>/<span class="number">1</span>    <span class="number">1</span>           <span class="number">0</span>          <span class="number">1</span>s</span><br><span class="line">ceph-mgr              <span class="number">0</span>/<span class="number">1</span>    <span class="number">1</span>           <span class="number">0</span>          <span class="number">1</span>s</span><br><span class="line">ceph-mon-check        <span class="number">0</span>/<span class="number">1</span>    <span class="number">1</span>           <span class="number">0</span>          <span class="number">1</span>s</span><br><span class="line">ceph-rbd-provisioner  <span class="number">0</span>/<span class="number">2</span>    <span class="number">2</span>           <span class="number">0</span>          <span class="number">1</span>s</span><br><span class="line">ceph-rgw              <span class="number">0</span>/<span class="number">1</span>    <span class="number">1</span>           <span class="number">0</span>          <span class="number">1</span>s</span><br></pre></td></tr></table></figure>
<p>等待一段时间执行完成后，通过如下命令确定是否成功运行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查 kubernetes 的 pod 状态</span></span><br><span class="line">~ <span class="comment"># kubectl get po -n ceph</span></span><br><span class="line">NAME                                    READY     STATUS    RESTARTS   AGE</span><br><span class="line">ceph-mds-<span class="number">5696</span>f9df5d-<span class="number">8</span>fc7l               <span class="number">0</span>/<span class="number">1</span>       Pending   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-mgr-<span class="number">8656</span>b978df-kcb6f               <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-mon-<span class="number">9</span>xqms                          <span class="number">3</span>/<span class="number">3</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-mon-check-<span class="number">7</span>d49bd686c-pkk7w         <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-mon-tw5n5                          <span class="number">3</span>/<span class="number">3</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-mon-x25rv                          <span class="number">3</span>/<span class="number">3</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-osd-dev-vdb-<span class="number">9</span>t8fh                  <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">2</span>h</span><br><span class="line">ceph-osd-dev-vdb-fgl8w                  <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">2</span>h</span><br><span class="line">ceph-osd-dev-vdb-sssqq                  <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">2</span>h</span><br><span class="line">ceph-rbd-provisioner-<span class="number">5544</span>dcbcf5-<span class="number">97</span>nxn   <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-rbd-provisioner-<span class="number">5544</span>dcbcf5-nfkhw   <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line">ceph-rgw-<span class="number">65</span>b4bd8cc5-ml7gk               <span class="number">0</span>/<span class="number">1</span>       Pending   <span class="number">0</span>          <span class="number">3</span>h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 ceph 集群状态</span></span><br><span class="line">~ <span class="comment"># kubectl exec -it ceph-mon-9xqms -n ceph -c ceph-mon -- ceph -s</span></span><br><span class="line">  cluster:</span><br><span class="line">    id:     <span class="number">726</span>cc770-<span class="number">3</span>daa-<span class="number">4792</span>-<span class="number">8</span>cd9-b100aea87711</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"></span><br><span class="line">  services:</span><br><span class="line">    mon: <span class="number">3</span> daemons, quorum host-<span class="number">10</span>-<span class="number">24</span>-<span class="number">0</span>-<span class="number">14</span>,host-<span class="number">10</span>-<span class="number">24</span>-<span class="number">0</span>-<span class="number">15</span>,host-<span class="number">10</span>-<span class="number">24</span>-<span class="number">0</span>-<span class="number">16</span></span><br><span class="line">    mgr: host-<span class="number">10</span>-<span class="number">24</span>-<span class="number">0</span>-<span class="number">14</span>(active)</span><br><span class="line">    osd: <span class="number">3</span> osds: <span class="number">3</span> up, <span class="number">3</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">data</span>:</span><br><span class="line">    pools:   <span class="number">1</span> pools, <span class="number">128</span> pgs</span><br><span class="line">    objects: <span class="number">3</span> objects, <span class="number">16</span> bytes</span><br><span class="line">    usage:   <span class="number">324</span> MB used, <span class="number">104</span> GB / <span class="number">104</span> GB avail</span><br><span class="line">    pgs:     <span class="number">128</span> active+clean</span><br></pre></td></tr></table></figure>
<p>至此，ceph 集群部署完成。 但是 创建的 storageclass 中的 secret 为空，需要更新 key: </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 ceph 集群的 client-admin-keyring</span></span><br><span class="line">kubectl exec -it ceph-mon-<span class="number">9</span>xqms -n ceph -c ceph-mon -- grep key /etc/ceph/ceph.client.admin.keyring |awk <span class="string">'&#123;printf "%s", $NF&#125;’|base64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 将上面输出的编码的 keyring 填入到 storageclass使用的 secret: pvc-ceph-client-key中, 替换 null 为以上值</span></span><br><span class="line"><span class="string">kubectl edit secret pvc-ceph-client-key  -n ceph</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建并初始化 rbd 池</span></span><br><span class="line"><span class="string">kubectl exec -it ceph-mon-9xqms -n ceph -c ceph-mon -- ceph osd pool create rbd 128 </span></span><br><span class="line"><span class="string">kubectl exec -it ceph-mon-9xqms -n ceph -c ceph-mon -- rbd pool init rbd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">最后， 验证通过 storageclass 动态分配 rbd image。</span></span><br><span class="line"><span class="string"># cat test-pvc.yaml</span></span><br><span class="line"><span class="string">kind: PersistentVolumeClaim</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: ceph-pvc-2</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  accessModes:</span></span><br><span class="line"><span class="string">   - ReadWriteOnce</span></span><br><span class="line"><span class="string">  resources:</span></span><br><span class="line"><span class="string">    requests:</span></span><br><span class="line"><span class="string">       storage: 2Gi</span></span><br><span class="line"><span class="string">  storageClassName: ceph-rbd</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string"># kubectl create -f pvc-rbd.yaml</span></span><br><span class="line"><span class="string">persistentvolumeclaim "ceph-pvc" created</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/template/ceph_connect # kubectl get pvc</span></span><br><span class="line"><span class="string">NAME         STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span><br><span class="line"><span class="string">ceph-pvc     Bound     pvc-a56fd3d2-9157-11e8-bd1d-fa163eaae838   2Gi        RWO            ceph-pool      1h</span></span><br><span class="line"><span class="string">ceph-pvc-2   Bound     pvc-b28baac0-9161-11e8-bd1d-fa163eaae838   2Gi        RWO            ceph-rbd       7s</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">~/template/ceph_connect # kubectl exec -it ceph-mon-9xqms -n ceph -c ceph-mon -- rbd ls</span></span><br><span class="line"><span class="string">kubernetes-dynamic-pvc-a57200fe-9157-11e8-9008-fa163eaae838</span></span><br><span class="line"><span class="string">kubernetes-dynamic-pvc-b2931fd1-9161-11e8-9ac7-0a580ae9410b</span></span><br></pre></td></tr></table></figure>
<h4 id="三、实际应用"><a href="#三、实际应用" class="headerlink" title="三、实际应用"></a>三、实际应用</h4><h5 id="1、创建一个使用此pvc的pod"><a href="#1、创建一个使用此pvc的pod" class="headerlink" title="1、创建一个使用此pvc的pod"></a>1、创建一个使用此pvc的pod</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ cat pod-with-rbd.yaml</span><br><span class="line">kind: Pod</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: mypod</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: busybox</span><br><span class="line">      image: busybox</span><br><span class="line">      command:</span><br><span class="line">        - sleep</span><br><span class="line">        - <span class="string">"3600"</span></span><br><span class="line">      volumeMounts:</span><br><span class="line">      - mountPath: <span class="string">"/mnt/rbd"</span></span><br><span class="line">        name: vol1</span><br><span class="line">  volumes:</span><br><span class="line">    - name: vol1</span><br><span class="line">      persistentVolumeClaim:</span><br><span class="line">        claimName: ceph-pvc</span><br><span class="line">$ kubectl create -f pod-with-rbd.yaml</span><br><span class="line">pod <span class="string">"mypod"</span> created</span><br></pre></td></tr></table></figure>
<h5 id="2、检查pod"><a href="#2、检查pod" class="headerlink" title="2、检查pod"></a>2、检查pod</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods</span><br><span class="line">NAME      READY     STATUS    RESTARTS   AGE</span><br><span class="line">mypod     <span class="number">1</span>/<span class="number">1</span>       Running   <span class="number">0</span>          <span class="number">17</span>s</span><br><span class="line">$ kubectl exec mypod -- mount | grep rbd</span><br><span class="line">/dev/rbd0 on /mnt/rbd type ext4 (rw,relatime,stripe=<span class="number">1024</span>,<span class="keyword">data</span>=ordered)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考文档：<a href="http://docs.ceph.com/docs/master/start/kube-helm/" target="_blank" rel="noopener">http://docs.ceph.com/docs/master/start/kube-helm/</a> </p>
<p><a href="http://docs.ceph.org.cn/start/intro/" target="_blank" rel="noopener">http://docs.ceph.org.cn/start/intro/</a> </p>
</blockquote>

        
    </section>
</article>



<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "f117eb282f890eafac3d",
        clientSecret: "13caf80f1f529128478f1fcbea32505d83fbea71",
        repo: "comment-repo",
        owner: "kenneth1996",
        admin: ["kenneth1996"],
        id: "2019/05/24/分布式文件系统-Ceph",
        distractionFreeMode: true,
        title: "分布式文件系统-Ceph",
        body: "http://kenneth96.coding.me/2019/05/24/分布式文件系统-Ceph/",
        labels: ["Ceph"]
    }).render('comments');
    </script>
</div>

</div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>

    
        &ensp;
        <span id="cnzz_stat_icon_1234567890" class="vm"></span>
        <script src="//s13.cnzz.com/stat.php?id=1234567890&show=pic" type="text/javascript"></script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }
            
            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    
        <script type="text/javascript" src="/js/scrollspy.min.js"></script>
        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});
        </script>
    

</body>
</html>
